# Документация класса Git

## Обзор
Класс `Git` обеспечивает автоматизированную синхронизацию Git репозиториев с GitHub, поддерживая личные аккаунты и организации с умной фильтрацией файлов и ограничениями размера.

---

## Конструкторы

### `Git(IZennoPosterProjectModel project, string token, string username, string branch = "master", string organization = null)`

**Назначение:** Инициализирует Git клиент с учетными данными GitHub.

**Пример:**
```csharp
var git = new Git(
    project,
    "ghp_yourGitHubToken",
    "yourusername",
    "main",
    "your-org"  // Опционально
);
git.SyncRepositories("C:/Projects", "Update commit");
```

**Разбор:**
```csharp
var git = new Git(
    project,         // IZennoPosterProjectModel - экземпляр проекта
    "ghp_token...",  // string - персональный токен доступа GitHub (должен начинаться с "ghp_")
    "username",      // string - имя пользователя GitHub
    "main",          // string - название ветки по умолчанию
    "organization"   // string - опциональное название организации
);
```

---

## Публичные методы

### `SyncRepositories(string baseDir, string commitMessage = "ts")`

**Назначение:** Синхронизирует несколько Git репозиториев из базовой директории на GitHub.

**Пример:**
```csharp
var git = new Git(project, token, username, "main");
git.SyncRepositories(
    "C:/MyProjects",
    "Обновлен код и документация"
);
// Синхронизирует все проекты, перечисленные в C:/MyProjects/.sync.txt
```

**Разбор:**
```csharp
git.SyncRepositories(
    "C:/Projects",              // string - базовая директория с проектами
    "Метка времени обновления"  // string - сообщение коммита ("ts" = авто временная метка)
);
// Читает список проектов из {baseDir}/.sync.txt
// Обрабатывает каждый проект: init, add, commit, push
// Логирует подробную статистику по завершении
```

---

### Файл конфигурации (.sync.txt)

Создайте файл `.sync.txt` в базовой директории:

```txt
project1
project2:false
project3
# Это комментарий
project4
```

- Каждая строка = одна папка проекта
- Добавьте `:false` для пропуска синхронизации
- Строки, начинающиеся с `#` - комментарии
- Пустые строки игнорируются

---

### `GetFileHash(string filePath)` [Статический]

**Назначение:** Вычисляет MD5 хеш файла для определения изменений.

**Пример:**
```csharp
string hash = Git.GetFileHash("C:/file.txt");
Console.WriteLine(hash);  // Вывод: "098f6bcd4621d373cade4e832627b4f6"
```

**Разбор:**
```csharp
string md5Hash = Git.GetFileHash(
    "C:/путь/к/file.txt"  // string - абсолютный путь к файлу
);
// Возвращает: string - MD5 хеш в нижнем регистре hex формат
// Возвращает: string.Empty - если чтение файла не удалось
```

---

## Ограничения размера и файлов

Класс применяет эти ограничения для предотвращения проблем:

| Тип ограничения | Значение |
|----------------|----------|
| Макс. размер файла | 100 МБ |
| Макс. общий размер репо | 1000 МБ |
| Макс. количество файлов | 10,000 файлов |

**Исключенные типы файлов:**
- Исполняемые: `.exe`, `.so`, `.dylib`, `.bin`, `.obj`, `.lib`, `.a`
- Архивы: `.zip`, `.rar`, `.7z`, `.tar`, `.gz`, `.bz2`
- Образы дисков: `.iso`, `.img`, `.dmg`, `.msi`, `.deb`, `.rpm`
- Медиа: `.mp4`, `.avi`, `.mkv`, `.mov`, `.mp3`, `.wav`
- Дизайн: `.psd`, `.ai`, `.sketch`, `.fig`
- Базы данных: `.db`, `.sqlite`, `.mdb`, `.accdb`

---

## Управление .gitignore

Автоматически создает/обновляет `.gitignore` с общими шаблонами:

```gitignore
*.exe
*.dll
*.zip
node_modules/
.vs/
.vscode/
bin/
obj/
Thumbs.db
.DS_Store
```

---

## Рабочий процесс

Для каждого проекта в `.sync.txt`:

1. **Проверка размера:** Валидирует количество файлов и общий размер
2. **Git Init:** Инициализирует репозиторий при необходимости
3. **Safe Directory:** Настраивает Git safe directory
4. **Настройка Remote:** Добавляет/обновляет URL удаленного GitHub репо
5. **Проверка статуса:** Проверяет изменения файлов
6. **Коммит:** Делает коммит изменений если они есть
7. **Push:** Принудительно пушит на GitHub
8. **Логирование:** Логирует результаты операции

---

## Статистика

После завершения логирует сводку:

```
=======================Summary=======================
Total=10, Changes=5, Skipped=3, SizeSkipped=1,
Committed=5, Failed=1
```

---

## Формат GitHub URL

**Личный аккаунт:**
```
https://{token}@github.com/{username}/{repo}.git
```

**Организация:**
```
https://{token}@github.com/{organization}/{repo}.git
```

---

## Примечания

- Требует установленный Git, доступный через командную строку
- Токен должен иметь права `repo` scope
- Использует принудительный push (`--force`) - будьте осторожны с существующими репозиториями
- Пропускает папки с директорией `.git` при подсчете файлов
- Создает ветку `master` по умолчанию (настраивается)
- Все Git операции выполняются в отдельных процессах
- Автоматически настраивает имя пользователя и email для коммитов
- Задержки потока: 2с между репозиториями, 5с после ошибок
