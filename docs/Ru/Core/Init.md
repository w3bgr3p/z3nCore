# Класс Init

Класс `Init` управляет инициализацией проекта, настройкой браузера, выбором аккаунтов и загрузкой кошельков для проектов ZennoPoster.

---

## Конструктор

### public Init(IZennoPosterProjectModel project, Instance instance, bool log = false)

**Назначение**: Создает новый экземпляр Init для управления инициализацией проекта и настройкой браузера.

**Пример**:
```csharp
// Создание экземпляра Init с включённым логированием
var init = new Init(project, instance, log: true);

// Параметры:
// - project: Экземпляр модели проекта ZennoPoster (обязательный)
// - instance: Текущий объект Instance (обязательный)
// - log: Включить подробное логирование (опционально, по умолчанию: false)

// Конструктор инициализирует внутренний Logger для отслеживания
// операций инициализации и настройки браузера
```

**Детали**:
- **project**: Интерфейс модели проекта ZennoPoster для доступа к переменным и методам проекта
- **instance**: Текущий объект экземпляра для управления браузером и сессией
- **log**: При установке в `true` включает подробное логирование всех операций инициализации
- **Исключения**: Конструктор не выбрасывает исключений

---

## PrepareInstance()

### public void PrepareInstance(string browserToLaunch = null, bool getscore = false)

**Назначение**: Подготавливает экземпляр, запуская браузер и настраивая его с прокси, cookies и параметрами WebGL.

**Пример**:
```csharp
var init = new Init(project, instance, log: true);

// Подготовка instance с браузером Chromium
init.PrepareInstance(
    browserToLaunch: "Chromium",  // Тип браузера для запуска
    getscore: false               // Пропустить проверку отпечатка браузера
);

// Этот метод выполняет:
// 1. Запускает браузер на основе параметра browserToLaunch или переменной cfgBrowser
// 2. Для Chromium: Устанавливает прокси, загружает cookies, настраивает отпечаток WebGL
// 3. Для режима WithoutBrowser: Просто запускается без браузера
// 4. Опционально запускает сканирование браузера для проверки и исправления проблем с отпечатком
// 5. Закрывает лишние вкладки, оставляя только одну активную

// Нет возвращаемого значения
// Выбрасывает исключение при неудачном запуске или настройке браузера после 3 попыток
```

**Детали**:
- **browserToLaunch**: Тип браузера для запуска - "Chromium", "ZB", "WithoutBrowser", или null для использования переменной cfgBrowser (по умолчанию: null)
- **getscore**: При `true` запускает сканирование отпечатка браузера и исправляет проблемы со временем при обнаружении (по умолчанию: false)
- **Возвращаемое значение**: void
- **Побочные эффекты**:
  - Запускает браузер с указанной папкой профиля
  - Устанавливает прокси и проверяет его работу
  - Загружает cookies из базы данных или файла
  - Настраивает отпечаток WebGL из базы данных
  - Закрывает лишние вкладки
- **Исключения**: Выбрасывает исключение после 3 неудачных попыток настройки браузера

---

## RunProject()

### public bool RunProject(List<string> additionalVars = null, bool add = true)

**Назначение**: Выполняет другой проект ZennoPoster с переданными переменными из текущего проекта.

**Пример**:
```csharp
var init = new Init(project, instance);

// Запуск другого проекта с дополнительными пользовательскими переменными
var additionalVariables = new List<string> { "customVar1", "customVar2" };
bool success = init.RunProject(
    additionalVars: additionalVariables,  // Пользовательские переменные для передачи
    add: true                              // Добавить к списку переменных по умолчанию
);

// Параметры:
// - additionalVars: Дополнительные переменные для передачи дочернему проекту
// - add: Если true, добавляет к стандартным переменным; если false, заменяет стандартные

// Возвращает: true если проект выполнен успешно, false в противном случае

// Переменные по умолчанию, передаваемые дочернему проекту:
// acc0, accRnd, cfgChains, cfgRefCode, cfgDelay, cfgLog, cfgPin, cfgToDo,
// cfgAccRange, DBmode, DBpstgrPass, DBpstgrUser, DBsqltPath, failReport,
// humanNear, instancePort, ip, lastQuery, pathCookies, projectName,
// projectTable, projectScript, proxy, requiredSocial, requiredWallets,
// toDo, varSessionId, wkMode
```

**Детали**:
- **additionalVars**: Список дополнительных имён переменных для передачи дочернему проекту (по умолчанию: null)
- **add**: При `true` добавляет additionalVars к списку по умолчанию; при `false` использует только additionalVars (по умолчанию: true)
- **Возвращаемое значение**: `bool` - true если выполнение проекта прошло успешно, false в противном случае
- **Побочные эффекты**: Выполняет дочерний проект, указанный в переменной `projectScript`
- **Исключения**: Исключения от выполнения дочернего проекта могут распространяться

---

## LoadWallets()

### public string LoadWallets(string walletsToUse)

**Назначение**: Загружает и инициализирует указанные расширения криптовалютных кошельков в браузере.

**Пример**:
```csharp
var init = new Init(project, instance, log: true);

// Загрузка нескольких кошельков - Backpack для Solana и Zerion для EVM-сетей
string loadedWallets = init.LoadWallets("Backpack,Zerion,Keplr");

// Параметры:
// - walletsToUse: Имена кошельков через запятую для загрузки

// Возвращает: Ту же строку, что была передана, или "noBrowser" если не используется Chromium

// Поддерживаемые кошельки:
// - Backpack: Кошелёк Solana, сохраняет адрес в переменную 'addressSol'
// - Zerion: EVM кошелёк, сохраняет адрес в переменную 'addressEvm'
// - Keplr: Кошелёк для экосистемы Cosmos

// Если установлен accRnd, использует случайное зерно для инициализации кошелька
// Повторяет попытки до 3 раз при неудачной загрузке кошелька
// Закрывает лишние вкладки после успешной загрузки
```

**Детали**:
- **walletsToUse**: Строка с именами кошельков через запятую - "Backpack", "Zerion", "Keplr"
- **Возвращаемое значение**: Возвращает входную строку при успехе, "noBrowser" если тип браузера не Chromium
- **Побочные эффекты**:
  - Загружает расширения кошельков в браузер
  - Устанавливает переменную `addressSol` для кошелька Backpack
  - Устанавливает переменную `addressEvm` для кошелька Zerion
  - Устанавливает переменную `refSeed` со случайным зерном если установлен accRnd
  - Закрывает лишние вкладки после загрузки
- **Исключения**: Выбрасывает исключение после 3 неудачных попыток

---

## InitVariables()

### public void InitVariables(string author = "")

**Назначение**: Инициализирует переменные проекта, отключает логи, устанавливает ID сессии и отображает логотип проекта.

**Пример**:
```csharp
var init = new Init(project, instance);

// Инициализация переменных проекта с именем автора
init.InitVariables(author: "w3bgr3p");

// Этот метод выполняет:
// 1. Отключает логи ZennoPoster созданием символической ссылки на NUL
// 2. Запускает проект проверки безопасности SAFU
// 3. Устанавливает ID сессии, имя проекта и имя таблицы проекта
// 4. Инициализирует модуль капчи если настроен
// 5. Проверяет обязательные переменные (cfgAccRange)
// 6. Обрабатывает конфигурацию диапазона аккаунтов
// 7. Инициализирует систему SAFU
// 8. Отображает логотип проекта с информацией о версии и авторе

// Нет возвращаемого значения
// Выбрасывает исключение если отсутствуют обязательные переменные
```

**Детали**:
- **author**: Имя автора для отображения в логотипе проекта (по умолчанию: пустая строка)
- **Возвращаемое значение**: void
- **Побочные эффекты**:
  - Отключает систему логирования ZennoPoster
  - Устанавливает переменные `varSessionId`, `projectName`, `projectTable`
  - Инициализирует модуль капчи если настроен
  - Обрабатывает переменную `cfgAccRange`
  - Отображает форматированный логотип в логе проекта
- **Исключения**: Выбрасывает исключение если обязательные переменные вроде `cfgAccRange` равны null или пусты

---

## AccountManager.ChooseAccountByCondition()

### public static void ChooseAccountByCondition(this IZennoPosterProjectModel project, string condition, string sortByTaskAge = null, bool useRange = true, bool filterTwitter = false, bool filterDiscord = false, bool debugLog = false)

**Назначение**: Выбирает аккаунт из базы данных на основе указанных условий, фильтров и групп приоритета.

**Пример**:
```csharp
// Выбор аккаунта со статусом 'ready' из настроенного диапазона
project.ChooseAccountByCondition(
    condition: "status = 'ready'",     // SQL условие WHERE
    sortByTaskAge: "last_run",         // Сортировка по этой колонке с датой (сначала старые)
    useRange: true,                    // Использовать cfgAccRange для фильтрации
    filterTwitter: true,               // Требовать Twitter аккаунт со статусом 'ok'
    filterDiscord: false,              // Не фильтровать по Discord
    debugLog: false                    // Отключить отладочное логирование
);

// После выполнения:
// - Устанавливает переменную 'acc0' в ID выбранного аккаунта
// - Обновляет статус аккаунта на 'working...' в базе данных
// - Логирует информацию о выборе: ID аккаунта, оставшиеся аккаунты, условие

// Группы приоритета в cfgAccRange:
// "1-10:11-20:21-30" - пробует 1-10 сначала, затем 11-20, затем 21-30
// "5,10,15" - пробует только аккаунты 5, 10, 15
// "1-100" - пробует аккаунты от 1 до 100

// Нет возвращаемого значения
// Выбрасывает исключение если аккаунты не найдены ни в одной группе приоритета
```

**Детали**:
- **condition**: SQL условие WHERE для фильтрации аккаунтов (например, "status = 'ready'")
- **sortByTaskAge**: Имя колонки для сортировки (сначала старые даты), null для случайного выбора (по умолчанию: null)
- **useRange**: При `true` применяет фильтрацию cfgAccRange для ограничения ID аккаунтов (по умолчанию: true)
- **filterTwitter**: При `true` требует Twitter аккаунт со status = 'ok' в таблице _twitter (по умолчанию: false)
- **filterDiscord**: При `true` требует Discord аккаунт со status = 'ok' в таблице _discord (по умолчанию: false)
- **debugLog**: При `true` логирует подробные SQL запросы и результаты (по умолчанию: false)
- **Возвращаемое значение**: void
- **Побочные эффекты**:
  - Устанавливает переменную `acc0` с ID выбранного аккаунта
  - Обновляет базу данных: устанавливает status в 'working...' для выбранного аккаунта
  - Удаляет выбранный аккаунт из списка 'accs' при использовании sortByTaskAge
  - Логирует информацию о выборе в лог проекта
- **Исключения**: Логирует предупреждение и не устанавливает acc0 если аккаунты не найдены

---

## Методы расширения

Следующие методы расширения предоставляют удобный доступ к функциональности Init.

### project.InitVariables()

### public static void InitVariables(this IZennoPosterProjectModel project, Instance instance, string author = "w3bgr3p")

**Назначение**: Метод расширения для инициализации переменных проекта без создания экземпляра Init.

**Пример**:
```csharp
// Инициализация переменных с пользовательским автором
project.InitVariables(instance, author: "myusername");

// Эквивалентно:
// new Init(project, instance).InitVariables("myusername");

// Это удобный метод, который создаёт Init внутренне
// и вызывает InitVariables() для настройки проекта

// Нет возвращаемого значения
```

**Детали**:
- **project**: Экземпляр IZennoPosterProjectModel (параметр this)
- **instance**: Объект Instance
- **author**: Имя автора для логотипа проекта (по умолчанию: "w3bgr3p")
- **Возвращаемое значение**: void
- **Исключения**: Те же, что и в InitVariables()

---

### project.RunBrowser()

### public static void RunBrowser(this IZennoPosterProjectModel project, Instance instance, string browserToLaunch = "Chromium", bool debug = false)

**Назначение**: Метод расширения для запуска браузера, если он ещё не запущен.

**Пример**:
```csharp
// Запуск браузера Chromium если он ещё не запущен
project.RunBrowser(
    instance,
    browserToLaunch: "Chromium",  // Тип браузера для запуска
    debug: false                   // Флаг режима отладки (в настоящее время не используется)
);

// Этот метод проверяет, запущен ли уже браузер
// Если тип браузера не Chromium или ChromiumFromZB,
// он вызовет PrepareInstance() для запуска указанного браузера

// Применение: Убедиться что браузер запущен перед выполнением кода, зависящего от браузера

// Нет возвращаемого значения
```

**Детали**:
- **project**: Экземпляр IZennoPosterProjectModel (параметр this)
- **instance**: Объект Instance для проверки и запуска браузера
- **browserToLaunch**: Тип браузера для запуска при необходимости (по умолчанию: "Chromium")
- **debug**: Флаг режима отладки (в настоящее время не используется в реализации) (по умолчанию: false)
- **Возвращаемое значение**: void
- **Побочные эффекты**: Запускает браузер если он ещё не запущен как Chromium или ChromiumFromZB
- **Исключения**: Те же, что и в PrepareInstance()
