# Документация класса Discord

## Класс: Discord

### Конструктор

#### Discord(IZennoPosterProjectModel project, Instance instance, bool log = false)

**Назначение**: Инициализирует новый экземпляр автоматизации Discord с контекстом проекта, экземпляром браузера и опциональным логированием.

**Пример**:
```csharp
var discord = new Discord(project, instance, log: true);
```

**Разбор**:
```csharp
// Параметры:
// - project: IZennoPosterProjectModel - Модель проекта ZennoPoster для операций с БД и макросами
// - instance: Instance - Экземпляр браузера для веб-автоматизации
// - log: bool - Включить детальное логирование (по умолчанию: false)
// Возвращает: Экземпляр Discord
// Примечание: Автоматически загружает учетные данные из базы данных при инициализации
```

---

## Методы аутентификации

### GetState(bool log = false)

**Назначение**: Определяет текущее состояние страницы Discord (авторизован, капча, требуется 2FA и т.д.).

**Пример**:
```csharp
string state = discord.GetState();
if (state == "logged") {
    // Продолжить действия
}
```

**Разбор**:
```csharp
// Параметры:
// - log: bool - Включить логирование для этой операции (по умолчанию: false)
// Возвращает: string - Текущее состояние страницы ("logged", "capctha", "input_otp", "input_credentials", "appDetected" и т.д.)
// Примечание: Использует обнаружение элементов для определения состояния страницы
```

### Load(bool log = false)

**Назначение**: Выполняет полную аутентификацию в Discord с использованием токена или учетных данных с автоматической обработкой состояний.

**Пример**:
```csharp
string result = discord.Load();
if (result == "logged") {
    project.SendInfoToLog("Discord успешно авторизован");
}
```

**Разбор**:
```csharp
// Параметры:
// - log: bool - Включить логирование (по умолчанию: false)
// Возвращает: string - Финальное состояние аутентификации
// Выбрасывает: Exception при неудачной аутентификации
// Примечание: Сначала пытается аутентификацию по токену, затем переходит к учетным данным
// Автоматически обрабатывает капчу, 2FA и другие вызовы аутентификации
```

### Auth()

**Назначение**: Выполняет действие авторизации путем прокрутки и нажатия кнопки авторизации на страницах OAuth Discord.

**Пример**:
```csharp
discord.Auth();
```

**Разбор**:
```csharp
// Параметры: Отсутствуют
// Возвращает: void
// Примечание: Используется для потоков авторизации OAuth
// Прокручивает страницу до видимости кнопки авторизации и нажимает её
```

---

## Методы серверов и ролей

### Servers(bool toDb = false, bool log = false)

**Назначение**: Получает список всех серверов Discord, к которым присоединен аккаунт, включая серверы в папках.

**Пример**:
```csharp
List<string> serverList = discord.Servers(toDb: true);
foreach (var server in serverList) {
    project.SendInfoToLog($"Сервер: {server}");
}
```

**Разбор**:
```csharp
// Параметры:
// - toDb: bool - Сохранить список серверов в базу данных (по умолчанию: false)
// - log: bool - Включить логирование (по умолчанию: false)
// Возвращает: List<string> - Список названий серверов
// Примечание: Разворачивает папки для получения всех серверов, сохраняет в таблицу "__discord" если toDb равно true
```

### GetRoles(string gmChannelLink, string gmMessage = "gm", bool log = false)

**Назначение**: Извлекает роли пользователя с сервера Discord путем отправки сообщения и чтения всплывающего окна пользователя.

**Пример**:
```csharp
List<string> roles = discord.GetRoles("https://discord.com/channels/123/456", "hello");
```

**Разбор**:
```csharp
// Параметры:
// - gmChannelLink: string - URL канала Discord для отправки сообщения
// - gmMessage: string - Сообщение для отправки (по умолчанию: "gm")
// - log: bool - Включить логирование (по умолчанию: false)
// Возвращает: List<string> - Список названий ролей
// Примечание: Отправляет сообщение, если имя пользователя не видно, кликает на имя пользователя для открытия всплывающего окна
```

### GM(string gmChannelLink, string message = "gm")

**Назначение**: Отправляет сообщение в указанный канал Discord.

**Пример**:
```csharp
discord.GM("https://discord.com/channels/123/456", "Всем привет!");
```

**Разбор**:
```csharp
// Параметры:
// - gmChannelLink: string - Полный URL канала Discord
// - message: string - Текст сообщения для отправки (по умолчанию: "gm")
// Возвращает: void
// Выбрасывает: Exception если канал недоступен или нет прав доступа
// Примечание: Переходит в канал, проверяет права доступа, отправляет сообщение
```

### UpdateServerInfo(string gmChannelLink)

**Назначение**: Обновляет базу данных названием сервера и ролями пользователя из канала.

**Пример**:
```csharp
discord.UpdateServerInfo("https://discord.com/channels/123/456");
```

**Разбор**:
```csharp
// Параметры:
// - gmChannelLink: string - URL канала Discord
// Возвращает: void
// Примечание: Создает новую колонку с именем сервера и сохраняет роли через запятую
// Объединяет операции GetRoles() и обновления базы данных
```
