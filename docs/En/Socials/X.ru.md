# Документация класса X (Twitter)

## Класс: X

### Конструктор

#### X(IZennoPosterProjectModel project, Instance instance, bool log = false)

**Назначение**: Инициализирует новый экземпляр автоматизации X (Twitter) с полными возможностями аутентификации и действий.

**Пример**:
```csharp
var twitter = new X(project, instance, log: true);
```

**Разбор**:
```csharp
// Параметры:
// - project: IZennoPosterProjectModel - Модель проекта для операций с базой данных
// - instance: Instance - Экземпляр браузера для автоматизации
// - log: bool - Включить детальное логирование (по умолчанию: false)
// Возвращает: Экземпляр X
// Примечание: Автоматически загружает учетные данные из таблицы "_twitter"
// Инициализирует Sleeper для случайных задержек между действиями
```

---

## API методы

### UserByScreenName()

**Назначение**: Извлекает данные пользователя из трафика API X по имени экрана.

**Пример**:
```csharp
Dictionary<string, string> userData = twitter.UserByScreenName();
string username = userData["user"];
```

**Разбор**:
```csharp
// Параметры: Отсутствуют
// Возвращает: Dictionary<string, string> - Данные пользователя, включая имя экрана
// Примечание: Захватывает сетевой трафик, содержащий эндпоинт "UserByScreenName"
// Автоматически обновляет страницу, если трафик не найден при первой попытке
// Выбрасывает исключение, если совпадающий трафик не найден после повтора
```

### Settings()

**Назначение**: Получает данные настроек аккаунта из трафика API X.

**Пример**:
```csharp
Dictionary<string, string> settings = twitter.Settings();
string screenName = settings["screen_name"];
```

**Разбор**:
```csharp
// Параметры: Отсутствуют
// Возвращает: Dictionary<string, string> - Данные настроек аккаунта
// Примечание: Захватывает трафик с эндпоинта "account/settings.json"
// Обновляет страницу при необходимости, выбрасывает исключение, если не найдено
```

### UserNameFromSetting(bool validate = false)

**Назначение**: Получает текущее имя пользователя из настроек аккаунта с опциональной валидацией.

**Пример**:
```csharp
string username = twitter.UserNameFromSetting(validate: true);
```

**Разбор**:
```csharp
// Параметры:
// - validate: bool - Проверить, что имя пользователя совпадает с ожидаемым логином (по умолчанию: false)
// Возвращает: string - Текущее имя экрана
// Выбрасывает: Exception если валидация включена и обнаружен неправильный аккаунт
// Примечание: Устанавливает переменную проекта "status" в "WrongAccount" при несовпадении
```

### GenerateJson(string purpouse = "tweet")

**Назначение**: Генерирует контент твита или треда с помощью AI на основе случайной новостной статьи.

**Пример**:
```csharp
string tweetJson = twitter.GenerateJson("tweet");
project.ToJson(tweetJson);
string tweet = project.Json.statement;
```

**Разбор**:
```csharp
// Параметры:
// - purpouse: string - Тип контента ("tweet", "thread", "opinionThread") (по умолчанию: "tweet")
// Возвращает: string - Контент в формате JSON
// Примечание: Читает случайную статью из папки .data/news
// Использует AI для генерации персонализированного ответа на основе био
// Формат tweet: макс. 280 символов, одно утверждение
// Формат thread: несколько утверждений для резюме и мнения
// OpinionThread: отдельные утверждения резюме и мнения
```

---

## Методы аутентификации

### Load(bool log = false)

**Назначение**: Выполняет полную аутентификацию в X с автоматической обработкой токена/учетных данных.

**Пример**:
```csharp
string status = twitter.Load();
if (status == "ok") {
    project.SendInfoToLog("Twitter успешно аутентифицирован");
}
```

**Разбор**:
```csharp
// Параметры:
// - log: bool - Включить логирование (по умолчанию: false)
// Возвращает: string - Статус аутентификации ("ok", "restricted", "suspended", "emailCapcha" и т.д.)
// Примечание: Сначала пытается аутентификацию по токену, затем переходит к учетным данным
// Автоматически извлекает и сохраняет новый токен при успешном входе
// Очищает куки и повторяет при обнаружении смешанного аккаунта
// Возвращает статус ошибки для: restricted, suspended, неправильных учетных данных
```

### LoginWithToken(string token = null)

**Назначение**: Аутентифицируется с использованием инъекции куки auth_token.

**Пример**:
```csharp
twitter.LoginWithToken();
```

**Разбор**:
```csharp
// Параметры:
// - token: string - Auth токен (использует загруженный токен, если null)
// Возвращает: void
// Примечание: Вставляет токен как куки через JavaScript
// Автоматически перезагружает страницу после инъекции
```

### LoginWithCredentials()

**Назначение**: Выполняет вход с использованием имени пользователя и пароля с поддержкой 2FA.

**Пример**:
```csharp
string result = twitter.LoginWithCredentials();
```

**Разбор**:
```csharp
// Параметры: Отсутствуют
// Возвращает: string - Результат входа ("ok" или сообщение об ошибке)
// Примечание: Обрабатывает ввод имени пользователя, пароля и OTP
// Определяет и возвращает ошибки: "NotFound", "WrongPass", "Suspended", "SuspiciousLogin"
// Автоматически сохраняет токен при успешном входе
```

### TokenGet()

**Назначение**: Извлекает auth_token из куков браузера и сохраняет в базу данных.

**Пример**:
```csharp
string token = twitter.TokenGet();
```

**Разбор**:
```csharp
// Параметры: Отсутствуют
// Возвращает: string - Извлеченный auth токен
// Примечание: Парсит JSON куков для поиска auth_token
// Обновляет таблицу "_twitter" токеном
```

### Auth()

**Назначение**: Обрабатывает поток авторизации OAuth для сторонних приложений.

**Пример**:
```csharp
twitter.Auth();
```

**Разбор**:
```csharp
// Параметры: Отсутствуют
// Возвращает: void
// Выбрасывает: Exception для ошибок (NotFound, Suspended, WrongPass, InvalidRequestToken)
// Примечание: Обрабатывает как OAuth v1, так и стандартные потоки входа
// Автоматически вводит учетные данные, OTP и подтверждает авторизацию
```

---

## Методы действий UI

### SendSingleTweet(string tweet, string accountToMention = null)

**Назначение**: Публикует один твит, опционально из профиля другого аккаунта.

**Пример**:
```csharp
twitter.SendSingleTweet("Привет Twitter!", accountToMention: "elonmusk");
```

**Разбор**:
```csharp
// Параметры:
// - tweet: string - Текст твита
// - accountToMention: string - Сначала перейти к этому профилю (опционально)
// Возвращает: void
// Выбрасывает: Exception если появляется сообщение об ошибке
// Примечание: Использует буфер обмена (CtrlV) для ввода текста
```

### SendThread(List<string> tweets, string accountToMention = null)

**Назначение**: Публикует тред Twitter с несколькими связанными твитами.

**Пример**:
```csharp
List<string> thread = new List<string> { "Твит 1", "Твит 2", "Твит 3" };
twitter.SendThread(thread);
```

**Разбор**:
```csharp
// Параметры:
// - tweets: List<string> - Список текстов твитов (первый - основной твит)
// - accountToMention: string - Сначала перейти к профилю (опционально)
// Возвращает: void
// Примечание: Первый элемент становится основным твитом, остальные - добавленными ответами
// Использует SendSingleTweet, если предоставлен только один твит
// Использует JavaScript взаимодействия для добавления ответов треда
```

### Follow()

**Назначение**: Подписывается на аккаунт на текущей странице профиля.

**Пример**:
```csharp
twitter.GoToProfile("elonmusk");
twitter.Follow();
```

**Разбор**:
```csharp
// Параметры: Отсутствуют
// Возвращает: void
// Примечание: Проверяет, подписан ли уже, перед кликом
// Немедленно возвращается, если обнаружена кнопка отписки
```

### RandomLike(string targetAccount = null)

**Назначение**: Ставит лайк случайному посту от указанного аккаунта или с текущей страницы.

**Пример**:
```csharp
twitter.RandomLike(targetAccount: "elonmusk");
```

**Разбор**:
```csharp
// Параметры:
// - targetAccount: string - Аккаунт, чьи посты лайкать (опционально)
// Возвращает: void
// Примечание: Фильтрует посты, чтобы лайкать только от целевого аккаунта
// Прокручивает вниз, если посты не найдены, повторяет до нахождения поста
// Использует случайный выбор из доступных постов
```

### RandomRetweet(string targetAccount = null)

**Назначение**: Делает ретвит случайного поста от указанного аккаунта.

**Пример**:
```csharp
twitter.RandomRetweet(targetAccount: "elonmusk");
```

**Разбор**:
```csharp
// Параметры:
// - targetAccount: string - Аккаунт, чьи посты ретвитить (опционально)
// Возвращает: void
// Примечание: Пропускает уже ретвитнутые посты
// Подтверждает действие ретвита в выпадающем меню
// Прокручивает и повторяет, если подходящие посты не найдены
```

### GetCurrentEmail()

**Назначение**: Получает адрес email, связанный с аккаунтом X.

**Пример**:
```csharp
string email = twitter.GetCurrentEmail();
```

**Разбор**:
```csharp
// Параметры: Отсутствуют
// Возвращает: string - Текущий email в нижнем регистре
// Примечание: Переходит на страницу settings/email
// Может потребовать подтверждения пароля
```

---

## Методы Intent ссылок

### FollowByLink(string screen_name)

**Назначение**: Подписывается на аккаунт с использованием Intent ссылки X.

**Пример**:
```csharp
twitter.FollowByLink("elonmusk");
```

**Разбор**:
```csharp
// Параметры:
// - screen_name: string - Имя пользователя целевого аккаунта
// Возвращает: void
// Примечание: Открывает в новой вкладке, подтверждает действие, закрывает вкладку
```

### LikeByLink(string tweet_id)

**Назначение**: Ставит лайк твиту с использованием Intent ссылки.

**Пример**:
```csharp
twitter.LikeByLink("1234567890");
```

**Разбор**:
```csharp
// Параметры:
// - tweet_id: string - ID твита для лайка
// Возвращает: void
// Примечание: Открывает в новой вкладке, авто-подтверждает, закрывает вкладку
```

### RetweetByLink(string tweet_id)

**Назначение**: Делает ретвит с использованием Intent ссылки.

**Пример**:
```csharp
twitter.RetweetByLink("1234567890");
```

**Разбор**:
```csharp
// Параметры:
// - tweet_id: string - ID твита для ретвита
// Возвращает: void
```

### ReplyByLink(string tweet_id, string text)

**Назначение**: Отвечает на твит с использованием Intent ссылки.

**Пример**:
```csharp
twitter.ReplyByLink("1234567890", "Отличный пост!");
```

**Разбор**:
```csharp
// Параметры:
// - tweet_id: string - ID твита для ответа
// - text: string - Текст ответа
// Возвращает: void
// Примечание: Автоматически кодирует текст ответа в URL
```

### QuoteByLink(string tweeturl)

**Назначение**: Цитирует твит с использованием Intent ссылки.

**Пример**:
```csharp
twitter.QuoteByLink("https://x.com/user/status/1234567890");
```

**Разбор**:
```csharp
// Параметры:
// - tweeturl: string - Полный URL твита для цитирования
// Возвращает: void
```

---

## Вспомогательные методы

### GoToProfile(string profile = null)

**Назначение**: Переходит на страницу профиля пользователя.

**Пример**:
```csharp
twitter.GoToProfile("elonmusk");
```

**Разбор**:
```csharp
// Параметры:
// - profile: string - Имя пользователя (использует свой профиль, если null)
// Возвращает: void
// Примечание: Пропускает навигацию, если уже на целевом профиле
```

### CheckCurrent()

**Назначение**: Проверяет, что текущий вошедший аккаунт совпадает с ожидаемым именем пользователя.

**Пример**:
```csharp
bool isCorrect = twitter.CheckCurrent();
```

**Разбор**:
```csharp
// Параметры: Отсутствуют
// Возвращает: bool - True если правильный аккаунт, false иначе
// Примечание: Очищает куки, если обнаружен неправильный аккаунт
```

### SkipDefaultButtons()

**Назначение**: Закрывает обычные всплывающие кнопки (куки, миграция, подсказки).

**Пример**:
```csharp
twitter.SkipDefaultButtons();
```

**Разбор**:
```csharp
// Параметры: Отсутствуют
// Возвращает: void
// Примечание: Пытается кликнуть: Принять куки, панель миграции, "Понятно"
// Использует нулевой дедлайн (не ждет, если не найдено)
```
