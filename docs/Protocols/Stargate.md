
## Документация класса Stargate

### Назначение

Класс **Stargate** автоматизирует работу с кроссчейн-бриджем Stargate (stargate.finance) в ZennoPoster: открытие страницы моста с нужными параметрами, подключение кошельков Zerion и Backpack, ввод адреса вручную, выставление параметров газа и слипа, сбор статистики по транзакциям, а также получение баланса и ожидаемой суммы на странице. Поддерживает работу с DOM, автоматизацию кликов, анализ интерфейса и интеграцию с базой данных проекта.

### Примеры использования

```csharp
// Открыть страницу моста между сетями
stargate.Go("arbitrum", "base");

// Подключить Zerion-кошелёк
stargate.Connect("Zerion");

// Получить баланс, отображаемый на странице
decimal balance = stargate.LoadBalance();

// Получить ожидаемое значение в поле ввода
decimal expected = stargate.WaitExpected();

// Ввести адрес получателя вручную
stargate.SetManualAddress("0x...");

// Установить значения газа и слипа
stargate.GasOnDestination("0.01", "0.5");

// Собрать и сохранить статистику по транзакциям
stargate.ParseStats();
```


## Описание методов

### Go

```csharp
public void Go(string srcChain, string dstChain, string srcToken = null, string dstToken = null)
```

- Открывает страницу моста Stargate с нужными параметрами (srcChain, dstChain, srcToken, dstToken).
- Если токены не указаны, подставляет дефолтный адрес ETH.
- Навигирует на нужный URL, если уже не открыт.
- Имитация клика по стрелке для открытия интерфейса выбора направления.


### Connect

```csharp
public void Connect(string wallet)
```

- Подключает указанный кошелёк ("Zerion" или "Backpack") к Stargate.
- В цикле проверяет состояние подключения:
    - Если уже подключён нужный кошелёк — кликает по кнопке подтверждения и завершает.
    - Для Zerion: кликает по "Connect Wallet", выбирает Zerion, вызывает подключение через ZerionWallet.
    - Для Backpack: если подключён Zerion, переключает на Backpack через меню "Connect Another Wallet".
    - В остальных случаях повторяет попытку подключения Zerion.
- Все этапы логируются.
- Использует вспомогательный класс ZerionWallet для авторизации.


### LoadBalance

```csharp
public decimal LoadBalance()
```

- Получает и возвращает текущий баланс, отображаемый на странице Stargate.
- Ожидает появления нужного блока, парсит баланс из текста (`Balance: ...`).
- Использует InvariantCulture для парсинга чисел.
- Повторяет попытки до успеха.


### WaitExpected

```csharp
public decimal WaitExpected()
```

- Получает ожидаемое значение (expected) из поля ввода на странице.
- Ожидает появления нужного input, парсит значение из атрибута value.
- Использует InvariantCulture для парсинга чисел.
- Повторяет попытки до успеха.


### SetManualAddress

```csharp
public void SetManualAddress(string address)
```

- Открывает меню Advanced Transfer.
- Включает режим ручного ввода адреса.
- Вводит указанный адрес в соответствующее поле.


### GasOnDestination

```csharp
public void GasOnDestination(string qnt, string sliperage = "0.5")
```

- Устанавливает количество газа (qnt) и слипа (sliperage) в соответствующие поля формы на странице Stargate.


### ParseStats

```csharp
public void ParseStats()
```

- Открывает главную страницу Stargate.
- Открывает окно транзакций.
- Собирает список всех транзакций (DOM-элементы с ссылками на layerzeroscan).
- Для каждой транзакции:
    - Определяет исходную и целевую сеть (src, dst)
    - Суммирует объёмы ETH и USDe
    - Ведёт счётчик по сетям (Arbitrum, Base, OP, Soneium, Solana, Unichain)
    - Формирует строку маршрутов (route)
    - Анализирует повторяющиеся временные интервалы (strike)
- Сохраняет статистику в базу через Sql.Upd:
    - `stats_volume`, `stats_chains`, `route`, `strike`
- Выводит собранную статистику в лог проекта.
- Закрывает окно транзакций.


## Вспомогательные детали

- Для поиска и кликов по элементам используются методы HeClick, HeSet, HeGet, FindElementByAttribute.
- Для логирования используется project.L0g и project.SendInfoToLog.
- Все методы защищены от таймаутов через project.Deadline.
- Для работы с ZerionWallet требуется отдельный вспомогательный класс.


## Особенности

- Поддержка подключения сразу двух кошельков (Zerion и Backpack) с автоматическим переключением.
- Автоматизация всех этапов взаимодействия с интерфейсом Stargate: от открытия страницы до сбора и сохранения статистики.
- Корректная обработка ошибок и повторные попытки при неудаче.
- Все ключевые параметры (баланс, маршруты, статистика) сохраняются в базу и логируются.
